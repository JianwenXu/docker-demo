# 镜像与容器

如果进行形象的表述，我们可以将 Docker 镜像理解为包含应用程序以及其相关依赖的一个基础文件系统，在 Docker 容器启动的过程中，它以只读的方式被用于创建容器的运行环境。

从另一个角度看，在之前的小节里我们讲到了，Docker 镜像其实是由基于 UnionFS 文件系统的一组镜像层依次挂载而得，而每个镜像层包含的其实是对上一镜像层的修改，这些修改其实是发生在容器运行的过程中的。所以，我们也可以反过来理解，镜像是对容器运行环境进行持久化存储的结果。

镜像是由一堆镜像层构成的，镜像之间可以共享镜像层，实现 1 + 1 < 2 的效果。

![](./assets/3-深入了解镜像.png)

## 镜像命名

镜像层的 ID 既可以识别每个镜像层，也可以用来直接识别镜像

镜像的明明可以分为三个部分
- username： 主要用于识别上传镜像的不同用户，与 GitHub 中的用户空间类似。
- repository：主要用于识别进行的内容，形成对镜像的表意描述。
- tag：主要用户表示镜像的版本，方便区分进行内容的不同细节

## 容器即应用

容器生命周期与应用生命周期的关系。

程序的主进程记为应用的主进程。

## 写时复制

## 命令

- docker images: 查看镜像

# 从镜像仓库获得镜像

## Docker Hub

https://hub.docker.com/

可以搜索镜像

## 命令参数识别

能识别出来即可，无需使用全部的 id

## 命令
- docker pull [IMAGE_NAME]: 获取镜像
  ```sh
  # 默认 tag 是 latest
  docker pull ubuntu
  # 完整的镜像名
  docker pull openresty/openresty:1.13.6.2-alpine
  ```
- docker search [IMAGE_NAME]: 搜索镜像
  ```sh
  docker search ubuntu
  ```
- docker inspect [IMAGE_NAME]: 查看镜像详细信息
  ```sh
  # 使用 name inspect
  docker inspect redis:3.2
  # 使用 id inspect
  docker inspect 2fef532e
  ```
- docker rmi [IMAGE_NAME]: 删除镜像
  ```sh
  docker rmi ubuntu:latest
  # 删除多个镜像
  docker rmi redis:3.2 redis:4.0
  ```

# 运行和管理容器

![容器状态流转](./assets/3-容器状态流转.png)

容器有5个状态:
- created
- Running
- Paused
- Stopped
- Deleted

## 命令
- docker create: 创建容器
  ```sh
  docker create nginx:1.12
  # 指定容器名
  docker create --name nginx nginx:1.12
  ```
- docker start [CONTAINER_NAME]: 启动容器
  ```sh
  docker start nginx
  ```
- docker run: docker create + docker start
  ```sh
  # -d/--detach: 后台运行
  docker run --name nginx -d nginx:1.12
  ```
- docker ps: 查看容器
  ```sh
  # 默认值列出 Running 的容器
  docker ps
  # -a/--all 列出所有容器
  docker ps -a
  ```
- docker stop: 停止正在运行的容器
  ```sh
  docker stop nginx
  ```
- docker rm: 删除容器
  ```sh
  docker rm nginx
  # 正在运行的容器默认不可删除，需要使用 -f/--force 强制删除
  docker rm -f nginx
  ```
- docker exec: 进入容器
  ```sh
  docker exec nginx more /etc/hostname
  docker exec -it nginx bash
  ```
- docker attach: 衔接容器
  ```sh
  # 前台的意思
  # 使用不多
  docker attach nginx
  ```

  

# 为容器配置网络
# 管理和存储数据