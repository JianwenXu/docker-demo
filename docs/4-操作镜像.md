# 保存和共享镜像

## 命令
- docker commit: 将容器修改的内容保存为镜像
  ```sh
  # 会输出一个镜像 id. repository 和 tag 都为 <none>
  docker commit webapp
  # 可以添加提交信息
  docker commit -m "Configured" webapp
  # 命名
  docker commit -m "Upgrade" webapp webapp：2.0
  ```
- docker tag: 为镜像命名
  ```sh
  # 指定一个 image id 为其命名
  docker tag 0bc42f7ff218 webapp:1.0
  # 为已有的一个镜像重新命名
  # 在 docker images 里面这两个会都存在
  docker tag webapp:1.0 webapp:latest
  ```
- 镜像迁移
  + docker save/load
    ```sh
    # 输入输出流的方式
    docker save webapp:1.0 > webapp-1.0.tar
    docker load < webapp-1.0.tar

    # 指定输入输出文件的方式
    docker save -o ./webapp-1.0.tar webapp:1.0
    docker load -i webapp-1.0.tar

    # 可以批量迁移
    docker save -o ./images.tar webapp:1.0 nginx:1.12 mysql:5.7
    ```
  + docker export/import: 导出和导入容器
    ```sh
    # 可以理解成 docker export 是 docker commit 和 docker save 的结合版
    docker export -o ./webapp.tar webapp
    # 导入不是直接将容器导入，而是将容器运行时的内容以镜像的形式导入
    docker import ./webapp.tar webapp:1.0
    ```
# 通过 Dockerfile 创建镜像

常见的 Dockerfile 指令:

- FROM
  ```txt
  FROM <image> [AS <name>]
  FROM <image>[:<tag>] [AS <name>]
  FROM <image>[@<digest>] [AS <name>]
  ```
- RUN
  ```txt
  RUN <command>
  RUN ["executable", "param1", "param2"]
  ```
- 启动命令 ENTRYPOINT/CMD
  ```txt
  ENTRYPOINT ["executable", "param1", "param2"]
  ENTRYPOINT command param1 param2

  CMD ["executable","param1","param2"]
  CMD ["param1","param2"]
  CMD command param1 param2
  ```
- EXPOSE 暴露端口
  ```txt
  EXPOSE <port> [<port>/<protocol>...]
  ```
- VOLUME 数据卷
  ```txt
  VOLUME ["/data"]
  ```
- COPY 和 ADD
  ```txt
  COPY [--chown=<user>:<group>] <src>... <dest>
  ADD [--chown=<user>:<group>] <src>... <dest>

  COPY [--chown=<user>:<group>] ["<src>",... "<dest>"]
  ADD [--chown=<user>:<group>] ["<src>",... "<dest>"]
  ```
## 命令
docker build 构建镜像
```sh
# 基于 webapp 目录构建
docker build ./webapp
# 指定 Dockerfile path 和 镜像名称
docker build -t webapp:latest -f ./webapp/a.Dockerfile ./webapp
# 指定镜像名称
docker build -t webapp:latest ./webapp
```
# 常见的 Dockerfile 使用技巧
